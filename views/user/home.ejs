<%- include("partials/header.ejs") %>
	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">	
<style>
	.wishlist-btn {
		font-size: 0.9rem;
	}
</style>
	<!-- Slider -->
	<section class="section-slide">
		<div class="wrap-slick1">
			<div class="slick1">
				<div class="item-slick1" style="background-image: url(images/SLIDE\ 1.png);">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="fadeInDown" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									NEW EDITION
								</span>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="fadeInUp" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									
                                    The Secret Speech
								</h2>
							</div>
								
							<!-- <div class="layer-slick1 animated visible-false" data-appear="zoomIn" data-delay="1600">
								<a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									Shop Now
								</a>
							</div> -->
						</div>
					</div>
				</div>

				<div class="item-slick1" style="background-image: url(/images/slide\ 02.png);">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="rollIn" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									NEW EDITION
								</span>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="lightSpeedIn" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									KELLEY AMSTRONG
								</h2>
							</div>
								
							<!-- <div class="layer-slick1 animated visible-false" data-appear="slideInUp" data-delay="1600">
								<a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									Shop Now
								</a>
							</div> -->
						</div>
					</div>
				</div>

				<div class="item-slick1" style="background-image: url(images/slide\ 3.png);">
					<div class="container h-full">
						<div class="flex-col-l-m h-full p-t-100 p-b-30 respon5">
							<div class="layer-slick1 animated visible-false" data-appear="rotateInDownLeft" data-delay="0">
								<span class="ltext-101 cl2 respon2">
									NEW EDITION
								</span>
							</div>
								
							<div class="layer-slick1 animated visible-false" data-appear="rotateInUpRight" data-delay="800">
								<h2 class="ltext-201 cl2 p-t-19 p-b-43 respon1">
									NORA ROBERTS OF BLOOD
								</h2>
							</div>
								
							<!-- <div class="layer-slick1 animated visible-false" data-appear="rotateIn" data-delay="1600">
								<a href="product.html" class="flex-c-m stext-101 cl0 size-101 bg1 bor1 hov-btn1 p-lr-15 trans-04">
									Shop Now
								</a>
							</div> -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>


	<!-- Banner -->
	


	<!-- Product -->
	<section class="bg0 p-t-23 p-b-140">
		<div class="container">
			
			<div class="row isotope-grid">
				<% products.forEach(function(item) { %> 
					<div class="col-sm-6 col-md-4 col-lg-3 p-b-35 isotope-item women">
						<div class="block2">
							<div class="block2-pic hov-img0">
								<img src="<%= item.images[0] %>" alt="IMG-PRODUCT">
								
								<a href="/product-detail/<%= item._id %>" class="block2-btn flex-c-m stext-103 cl2 size-102 bg0 bor2 hov-btn1 p-lr-15">
									Quick View
								</a>
							</div>
							
							<div class="block2-txt flex-w flex-t p-t-14">
								<div class="block2-txt-child1 flex-col-l">
									<a href="/product-detail/<%= item._id %>" class="stext-104 cl4 hov-cl1 trans-04 js-name-b2 p-b-6">
										<%= item.title %>
									</a>
									
									<!-- Display original and discounted price -->
									<span class="stext-105 cl3">
										<% if (item.hasDiscount) { %>
											<span style="text-decoration: line-through; color: red;">
												₹<%= item.price.toFixed(2) %>
											</span>
											<span style="color: green; font-weight: bold;">
												₹<%= item.discountedPrice.toFixed(2) %>
											</span>
										<% } else { %>
											₹<%= item.price.toFixed(2) %>
										<% } %>
									</span>
								</div>
								
			
								<div class="d-flex align-items-center mt-2">
									<form action="/wishlistAdd/<%= item._id %>" method="POST" id="wishlist-form-<%= item._id %>">
										<input type="hidden" name="productId" value="<%= item._id %>">
										<button type="submit" class="btn btn-outline-dark py-2 px-3 me-2 d-flex align-items-center wishlist-btn">
											<i class="bi bi-bookmark me-1"></i> Wishlist
										</button>
									</form>
			
								<form id="add-to-cart-form-<%= item._id %>">
										<input type="hidden" name="productId" value="<%= item._id %>">
										<% if (item.stock > 0) { %>
											<button type="submit" class="btn btn-primary py-2 px-3 d-flex align-items-center">
												<i class="bi bi-cart-check me-1"></i> Add Cart
											</button>
										<% } else { %>
											<button type="button" class="btn btn-outline-danger py-2 px-4 rounded opacity-70 cursor-not-allowed" disabled>Sold Out</button>
										<% } %>
									</form>
									
								</div>
							</div>
						</div>
					</div>
				<% }); %>
			</div>
			
<script>
									
	document.querySelectorAll('form[id^="add-to-cart-form-"]').forEach(form => {
        form.addEventListener('submit', async (e) => {
            e.preventDefault(); // Prevent the form from submitting normally

            const form = e.target;

			console.log();
			console.log(form);

			let productId = form.id.split('-')[4] 
			
            const formData = new FormData(form);
			formData.append('productId',form.id.split('-')[4])
			
            try {
                console.log("Submitting form..."); 

                const response = await fetch(`/cart/add/${productId}`, {
                    method: 'POST',
                });

                // Ensure response is in JSON format
                const data = await response.json(); // Parse the JSON response

                console.log("Response data:", data); // Debugging message to check the response

                // Handle success or failure based on the response
                if (data.success) {
                    // If successful, show a success alert with SweetAlert
                    Swal.fire({
                        title: 'Success',
                        text: data.message, // Success message from the server
                        icon: 'success',
                        confirmButtonText: 'OK'
                    });
                } else {
                    // If unsuccessful, show an error alert
                    Swal.fire({
                        title: 'Error',
                        text: data.message, // Error message from the server
                        icon: 'error',
                        confirmButtonText: 'Try Again'
                    });
                }
            } catch (error) {
                // Handle any errors that occur during the fetch request
                console.error('Error:', error);
                Swal.fire({
                    title: 'Error',
                    text: 'An error occurred while adding the item to the cart.',
                    icon: 'error',
                    confirmButtonText: 'Try Again'
                });
            }
        });
    });

				// Make sure to include SweetAlert library in your HTML file

				let isSubmitting = false;

document.addEventListener('DOMContentLoaded', function() {
	const wishlistButtons = document.querySelectorAll('.wishlist-btn');

	wishlistButtons.forEach(button => {
		button.addEventListener('click', function(e) {
			e.preventDefault(); // Prevent default form submission

			if (isSubmitting) return; // Prevent multiple submissions

			const formElement = this.closest('form');
			const productId = formElement.querySelector('input[name="productId"]').value;

			isSubmitting = true;
			button.disabled = true;

			// Send AJAX request
			fetch(formElement.action, {
				method: 'POST',
				body: JSON.stringify({ productId }),
				headers: {
					'Content-Type': 'application/json'
				}
			})
			.then(response => response.json())
			.then(data => {
				if (data.success) {
					// Change icon on success
					button.innerHTML = '<i class="bi bi-bookmark-heart-fill me-1"></i> Wishlisted';
					button.classList.add('wishlist-added');
					button.disabled = true;

					// Show SweetAlert success message
					Swal.fire({
						icon: 'success',
						title: 'Added to Wishlist!',
						text: 'The item has been successfully added to your wishlist.',
						showConfirmButton: false,
						timer: 1500
					});
				} else {
					// Show SweetAlert error message
					Swal.fire({
						icon: 'error',
						title: 'Oops...',
						text: data.message || 'Could not add to wishlist.',
					});
					button.disabled = false;
				}
				isSubmitting = false;
			})
			.catch(error => {
				console.error('Error:', error);

				// Show SweetAlert for unexpected error
				Swal.fire({
					icon: 'error',
					title: 'Unexpected Error',
					text: 'An unexpected error occurred. Please try again later.',
				});
				button.disabled = false;
				isSubmitting = false;
			});
		});
	});
});


			</script>
			

				

			<!-- Load more -->
			<div class="flex-c-m flex-w w-full p-t-45">
				<a href="/products" class="flex-c-m stext-101 cl5 size-103 bg2 bor1 hov-btn1 p-lr-15 trans-04">
					Load More
				</a>
			</div>
		</div>
	</section>


	<!-- Footer -->
	<footer class="bg3 p-t-75 p-b-32">
		<div class="container">
			<div class="row">
				<div class="col-sm-6 col-lg-4 p-b-50">
					<h4 class="stext-301 cl0 p-b-30">
						Categories
					</h4>
					<ul>
						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Fiction
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Non Fiction
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Kids
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Business
							</a>
						</li>
					</ul>
				</div>

				<div class="col-sm-6 col-lg-4 p-b-50">
					<h4 class="stext-301 cl0 p-b-30">
						Help
					</h4>

					<ul>
						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Track Order
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Returns 
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								Shipping
							</a>
						</li>

						<li class="p-b-10">
							<a href="#" class="stext-107 cl7 hov-cl1 trans-04">
								FAQs
							</a>
						</li>
					</ul>
				</div>

				<div class="col-sm-6 col-lg-4 p-b-50">
					<h4 class="stext-301 cl0 p-b-30">
						GET IN TOUCH
					</h4>

					<p class="stext-107 cl7 size-201">
						Any questions? Let us know in store at 8th floor, 379 Hudson St, New York, NY 10018 or call us on (+1) 96 716 6879
					</p>

					<div class="p-t-27">
						<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
							<i class="fa fa-facebook"></i>
						</a>

						<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
							<i class="fa fa-instagram"></i>
						</a>

						<a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
							<i class="fa fa-pinterest-p"></i>
						</a>
					</div>
				</div>	
			</div>


		</div>
	</footer>


	<!-- Back to top -->
	<div class="btn-back-to-top" id="myBtn">
		<span class="symbol-btn-back-to-top">
			<i class="zmdi zmdi-chevron-up"></i>
		</span>
	</div>

	<!-- Modal1 -->
	
<!--===============================================================================================-->	
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="vendor/slick/slick.min.js"></script>
	<script src="js/slick-custom.js"></script>
<!--===============================================================================================-->
	<script src="vendor/parallax100/parallax100.js"></script>
	<script>
        $('.parallax100').parallax100();
	</script>
<!--===============================================================================================-->
	<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
	<script>
		$('.gallery-lb').each(function() { // the containers for all your galleries
			$(this).magnificPopup({
		        delegate: 'a', // the selector for gallery item
		        type: 'image',
		        gallery: {
		        	enabled:true
		        },
		        mainClass: 'mfp-fade'
		    });
		});
	</script>
<!--===============================================================================================-->
	<script src="vendor/isotope/isotope.pkgd.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/sweetalert/sweetalert.min.js"></script>
	<script>


		/*---------------------------------------------*/

		$('.js-addcart-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().parent().find('.js-name-detail').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to cart !", "success");
			});
		});
	
	</script>
<!--===============================================================================================-->
	<script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>

</body>
</html>